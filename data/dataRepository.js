// Generated by CoffeeScript 1.9.0
var data, deleteFrom, fs, index, indexData, insertInto, loadData, selectFrom, updateIn;

fs = require('fs');

data = {};

index = {};

loadData = function() {
  data = JSON.parse(fs.readFileSync('data/data.json', 'utf8'));
  return indexData();
};

indexData = function() {
  var createIndex;
  createIndex = function(array) {
    var result;
    result = {
      _maxId: 0
    };
    if (array != null) {
      array.forEach(function(item) {
        result[item.id] = item;
        if (item.id > result._maxId) {
          result._maxId = item.id;
        }
      });
    }
    return result;
  };
  return index = {
    shops: createIndex(data.shops),
    articles: createIndex(data.articles),
    receipts: createIndex(data.receipts)
  };
};

selectFrom = function(tableName, criteria, callback) {
  var idx, tbl;
  if ((criteria != null ? criteria.id : void 0) != null) {
    idx = index[tableName];
    return typeof callback === "function" ? callback(null, idx[criteria.id]) : void 0;
  }
  tbl = data[tableName];
  return typeof callback === "function" ? callback(null, tbl) : void 0;
};

insertInto = function(tableName, record, callback) {
  var idx, tbl;
  tbl = data[tableName];
  idx = index[tableName];
  record.id = ++idx._maxId;
  tbl.push(record);
  idx[record.id] = record;
  return typeof callback === "function" ? callback(null, record) : void 0;
};

updateIn = function(tableName, record, callback) {};

deleteFrom = function(tableName, id, callback) {};

loadData();

module.exports = {
  shops: {
    select: function(criteria, callback) {
      return selectFrom('shops', criteria, callback);
    },
    create: function(shop, callback) {
      return insertInto('shops', shop, callback);
    }
  },
  articles: {},
  receipts: {}
};
